<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Bonoldi Enrico, Classe 5AI <!-- omit in toc --></title>
        <style>
</style>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        <link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        <script src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
        
    </head>
    <body class="vscode-light">
        <h1 id="bonoldi-enrico-classe-5ai-">Bonoldi Enrico, Classe 5AI <!-- omit in toc --></h1>
<h2 id="elaborato-individuale-di-informatica-e-sistemi-e-reti-">ELABORATO INDIVIDUALE DI INFORMATICA E SISTEMI E RETI <!-- omit in toc --></h2>
<ul>
<li><a href="#informatica">INFORMATICA</a>
<ul>
<li><a href="#1-analisi">1. Analisi</a>
<ul>
<li><a href="#soluzione-proposta">Soluzione proposta</a></li>
<li><a href="#tecnologie-utilizzate">Tecnologie utilizzate</a>
<ul>
<li><a href="#lato-server">lato server</a></li>
<li><a href="#lato-client">lato client</a></li>
</ul>
</li>
<li><a href="#struttura">Struttura</a></li>
<li><a href="#supposizioni">Supposizioni</a></li>
<li><a href="#possibili-sviluppi-futuri">Possibili sviluppi futuri</a></li>
</ul>
</li>
<li><a href="#2-modello-concettuale-e-logico">2. Modello concettuale e logico</a>
<ul>
<li><a href="#modello-er">Modello ER</a></li>
<li><a href="#modello-logico">Modello logico</a></li>
<li><a href="#note-di-realizzazione">note di realizzazione</a></li>
</ul>
</li>
<li><a href="#3-implementazione-database">3. Implementazione database</a></li>
<li><a href="#4-query-significative">4. Query significative</a>
<ul>
<li><a href="#ricerca-dei-partner">Ricerca dei partner</a></li>
<li><a href="#orientamento-sessuale">Orientamento sessuale</a></li>
</ul>
</li>
<li><a href="#5-applicazione-web-implementazione-completa">5. Applicazione Web (implementazione completa)</a>
<ul>
<li><a href="#loginregistrazione">Login/Registrazione</a></li>
<li><a href="#ricerca">Ricerca</a></li>
<li><a href="#profilo-account">Profilo account</a></li>
<li><a href="#profilo-utente">Profilo utente</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#sistemi-e-reti">SISTEMI E RETI</a></li>
</ul>
<hr>
<h2 id="descrizione"><em>Descrizione</em></h2>
<blockquote>
<p>Un’agenzia matrimoniale vuole gestire e pubblicare con un’applicazione web le informazioni per la
ricerca della propria anima gemella in un dato territorio.</p>
</blockquote>
<h1 id="informatica">INFORMATICA</h1>
<h2 id="1-analisi">1. Analisi</h2>
<p>Soggetto : Agenzia Matrimoniale<br>
Clienti : Chiunque (vedi supposizioni...)</p>
<p>L'applicativo deve fornire l'accesso alle azioni di ricerca in modo semplice e veloce.</p>
<blockquote>
<p><em>Entrando in un ambito così personale è necessario tener conto della sicurezza relativa ai dati sensibili.</em></p>
</blockquote>
<h3 id="soluzione-proposta">Soluzione proposta</h3>
<p>La scelta dell'abiente è ricaduta su nodeJS e expressJS data la loro immediatezza e velocità di sviluppo.
Offrono stumenti (validator,session manager,...) che permettono di gestire in sicurezza le parti piu critiche della applicazione quali inserimento di dati e autenticazione.</p>
<h3 id="tecnologie-utilizzate">Tecnologie utilizzate</h3>
<h4 id="lato-server">lato server</h4>
<ul>
<li><a href="https://nodejs.org/it/">NodeJS</a></li>
<li><a href="https://expressjs.com/it/">ExpressJS</a>
<ul>
<li><a href="https://www.npmjs.com/package/express-session">express-session</a></li>
<li><a href="https://ejs.co/">EJS</a> (templating)</li>
<li><a href="https://www.npmjs.com/package/pg">pg</a></li>
</ul>
</li>
</ul>
<h4 id="lato-client">lato client</h4>
<ul>
<li>HTML</li>
<li>CSS (<a href="https://getbootstrap.com/">Bootstrap</a>)</li>
<li>Javascript
<ul>
<li><a href="https://leafletjs.com/">Leaflet</a> (mappe)</li>
<li><a href="https://jquery.com/">Jquery</a></li>
</ul>
</li>
</ul>
<h3 id="struttura">Struttura</h3>
<p>La struttura del progetto è la seguente:</p>
<ul>
<li><strong>Accesso</strong>
<ul>
<li><strong>Registrazione</strong></li>
<li><strong>Login/Logout</strong></li>
</ul>
</li>
<li><strong>Ricerca</strong></li>
<li>Gestione profilo</li>
</ul>
<h5 id="in-grassetto-i-servizi-implementati-nella-soluzione-finale-">in grassetto i servizi implementati nella soluzione finale. <!-- omit in toc --></h5>
<h3 id="supposizioni">Supposizioni</h3>
<ol>
<li>gli iscritti al sistema siano maggiorenni.</li>
<li>l'orientamento sessuale di ogni utente può essere maschio e/o femmina.</li>
<li>ricerca
<ol>
<li>basata sulla distanza tra i comuni di residenza degli utenti dal quello dell'utente che ricerca.</li>
<li>basata sul orientamento sessuales</li>
</ol>
</li>
</ol>
<h3 id="possibili-sviluppi-futuri">Possibili sviluppi futuri</h3>
<ol>
<li>Ampliamento profilo e ricerca (carattere, aspetto,...)</li>
<li>Messaggistica istantanea.</li>
</ol>
<h2 id="2-modello-concettuale-e-logico">2. Modello concettuale e logico</h2>
<h4 id="modello-er">Modello ER</h4>
<p><img src="http://localhost:8080/assets/ER.png" alt="ER"></p>
<h4 id="modello-logico">Modello logico</h4>
<p>CITTA(<ins>istat_id</ins>,comune,provincia,regione,posizione)<br>
CAP(<em><ins>istat_id</ins></em>,<ins>CAP</ins>)</p>
<p>SESSO(<ins>id</ins>,nome)<br>
UTENTE(<ins>id</ins>,<em>sesso_id</em>,<em>residenza_id</em>,email,password,nome,cognome,data_nascita,telefono)</p>
<p>ORIENTAMENTO(<em><ins>	utente_id </ins></em>,	<em><ins>sesso_id </ins></em>)</p>
<h4 id="note-di-realizzazione">note di realizzazione</h4>
<ul>
<li>La tabella <code>CAP</code> è attualmente inutilizzata ma è stata inserita per completezza.</li>
<li>E' stata inserita una vista per facilitare l'accesso ai dati utente.</li>
</ul>
<h2 id="3-implementazione-database">3. Implementazione database</h2>
<p>DDL disponibile <a href="https://github.com/Bonoldiz/bonoldi_enrico_esame_2020/blob/master/app/db/agenzia_immobiliare.ddl.sql">qui</a><br>
<a href="app/db/agenzia_immobiliare.ddl.sql">app/db/agenzia_immobiliare.ddl.sql</a></p>
<h2 id="4-query-significative">4. Query significative</h2>
<h4 id="ricerca-dei-partner"><a href="https://github.com/Bonoldiz/bonoldi_enrico_esame_2020/blob/master/app/libs/user.js#L37">Ricerca dei partner</a></h4>
<p><a href="app/libs/user.js#L37">app/libs/user.js</a></p>
<blockquote>
<p>$1 - id utente<br>
$2 - distanza dall'utente corrente (in metri)</p>
</blockquote>
<pre><code class="language-sql"><div><span class="hljs-keyword">SELECT</span>
   *,
   ST_AsText(posizione) <span class="hljs-keyword">as</span> posizione_coordinate,
   ST_Distance(
      info_utente.posizione,
      (
         <span class="hljs-keyword">SELECT</span>
            posizione
         <span class="hljs-keyword">from</span>
            info_utente
         <span class="hljs-keyword">where</span>
            info_utente.id = $<span class="hljs-number">1</span>
      )
   ) <span class="hljs-keyword">as</span> distance_between
<span class="hljs-keyword">from</span>
   info_utente
<span class="hljs-keyword">where</span>
   (
      ST_Distance(
         info_utente.posizione,
         (
            <span class="hljs-keyword">SELECT</span>
               posizione
            <span class="hljs-keyword">from</span>
               info_utente
            <span class="hljs-keyword">where</span>
               info_utente.id = $<span class="hljs-number">1</span>
         )
      ) &lt; $<span class="hljs-number">2</span>
      <span class="hljs-keyword">AND</span> <span class="hljs-keyword">position</span>(
         (
            <span class="hljs-keyword">SELECT</span>
               sesso
            <span class="hljs-keyword">from</span>
               info_utente
            <span class="hljs-keyword">where</span>
               info_utente.id = $<span class="hljs-number">1</span>
         ) <span class="hljs-keyword">in</span> info_utente.orientamento_aggregato
      ) &gt; <span class="hljs-number">0</span>
      <span class="hljs-keyword">AND</span> <span class="hljs-keyword">position</span>(
         info_utente.sesso <span class="hljs-keyword">in</span> (
            <span class="hljs-keyword">SELECT</span>
               orientamento_aggregato
            <span class="hljs-keyword">from</span>
               info_utente
            <span class="hljs-keyword">where</span>
               info_utente.id = $<span class="hljs-number">1</span>
         )
      ) &gt; <span class="hljs-number">0</span>
   )
   <span class="hljs-keyword">OR</span> info_utente.id = $<span class="hljs-number">1</span>
</div></code></pre>
<h4 id="orientamento-sessuale"><a href="https://github.com/Bonoldiz/bonoldi_enrico_esame_2020/blob/master/app/db/agenzia_immobiliare.ddl.sql#L111">Orientamento sessuale</a></h4>
<p><a href="app/db/agenzia_immobiliare.ddl.sql#L111">app/db/agenzia_immobiliare.ddl.sql</a></p>
<p>utilizzata nella costruzione della view <code>info_utente</code></p>
<pre><code class="language-sql"><div><span class="hljs-keyword">SELECT</span>
   orientamento.utente_id,
   array_to_string(array_agg(sesso.nome), <span class="hljs-string">','</span> :: <span class="hljs-built_in">text</span>) 
   <span class="hljs-keyword">AS</span> orientamento_aggregato
<span class="hljs-keyword">FROM</span>
   orientamento,
   sesso sesso
<span class="hljs-keyword">WHERE</span>
   orientamento.sesso_id = sesso.id
<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span>
   orientamento.utente_id
</div></code></pre>
<h2 id="5-applicazione-web-implementazione-completa">5. Applicazione Web (implementazione completa)</h2>
<h3 id="loginregistrazione">Login/Registrazione</h3>
<ul>
<li>Inizializzazione di una nuova sessione</li>
<li>Controllo accesso via <a href="https://github.com/Bonoldiz/bonoldi_enrico_esame_2020/blob/master/app/middlewares/auth.js#L5">middleware</a> (<a href="app/middlewares/auth.js#L5">app/middlewares/auth.js</a>)</li>
<li>Validazione e registrazione</li>
</ul>
<p><img src="http://localhost:8080/assets/login.png" alt="login page">
<img src="http://localhost:8080/assets/registrazione.png" alt="register page"></p>
<h3 id="ricerca">Ricerca</h3>
<ul>
<li><a href="https://github.com/Bonoldiz/bonoldi_enrico_esame_2020/blob/master/app/public/js/usersMap.js">Ricerca dinamica</a> dei possibili partner in un certo range (in km)</li>
<li>l'endpoint per la ricerca è <code>/api/find/{range in metri}</code>
<ul>
<li>ritornerà una lista di utenti compatibili</li>
</ul>
</li>
</ul>
<p><img src="http://localhost:8080/assets/find.png" alt="find page"></p>
<h3 id="profilo-account">Profilo account</h3>
<ul>
<li>Visionare i dati personali del proprio account</li>
<li>Modificare l'immagine profilo (cliccando sull'immagine corrente)
<ul>
<li>l'endpoint per la modifica dell'immagine profilo è <code>/users/img</code></li>
</ul>
</li>
</ul>
<p><img src="http://localhost:8080/assets/profile.png" alt="profile page"></p>
<h3 id="profilo-utente">Profilo utente</h3>
<ul>
<li>Visionare i dati dell'account di un utente iscritto alla piattaforma</li>
</ul>
<p><img src="http://localhost:8080/assets/user.png" alt="user page"></p>
<h1 id="sistemi-e-reti">SISTEMI E RETI</h1>

    </body>
    </html>